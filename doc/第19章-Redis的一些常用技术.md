# 第19章 Redis的一些常用技术

标签：SSM

---

## Redis事务

- 特点
	- 被隔离的
	- 原子性
- 使用SessionCallback接口进行处理
- Redis事务命令
	- multi开启事务
	- watch key1 监听某些键 类似快照若事务过程中数据被改变则回滚
	- unwatch key1
	- exec 执行
	- discard 回滚事务
- 事务回滚两种情况
	- 命令格式正确而数据操作不正确，该条语句不执行，其他执行
	- 命令格式出错，全部语句不执行（回滚）
- watch监控事物
	- 在执行更新前，比较当前线程副本保存的旧值和当前线程共享的值是否一致，一致才执行，否则回滚
	- 弊端：面临ABA问题，中途发生过改变对其他数据产生不正确影响，但最终执行前回到A无法被检测。这种情况应多加入字段version值，当每次操作后即对version自增1，比较值是否与之前一致与最末是否发生改变

---

## Redis流水线

- 主要用于没有任何附加条件的场景，使用队列批量执行一系列的命令，优化性能
- 书中附有代码(Java、Spring结合Redis均有)
`Pipeline pipeline=jedis.pipelined();...（Java）`
`List resultList=redisTempalte.executePipelined(callback);...（Spring）`

---

## 发布订阅（观察者模式）

- 书中附代码，Spring提供发布订阅相关的接口如接收消息的类等MessageListener...

---

## 超时命令

- 可以设置超时，但Redis只会标识哪些键值对超时了，不会马上被回收。根据指定的回收策略进行回收。
- 回收策略有定时回收和惰性回收。定时回收可以完全回收超时的键值对，但缺点是一次大操作容易导致停顿，所以系统设计者一般选择在没有业务发生的时刻触发Redis的定时回收，以便清理超时的键值对
- 惰性回收，可指定要回收的键值对，但难以判断哪些要执行
- 书中附代码

---

## 使用Lua语言


- Redis支持两种方法运行脚本
	- 一种是直接输入一些Lua语言的程序代码
	- 一种是将Lua语言编写成文件
- 注：Redis缓存脚本德国哦你跟那个会哦通过SHA-1签名算法加密脚本，返回一个标识字符串。若脚本很长，从客户端传输可能需要很长的事件，那么使用标识字符串，则只需要传递32位字符串即可，这样能够提高传输的效率，从而提高性能
- 书中附代码